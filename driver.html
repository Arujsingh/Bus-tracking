<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punjab Village Driver Portal - CityTrack</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --gray: #7f8c8d;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--primary);
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .logo i {
            font-size: 24px;
            margin-right: 10px;
            color: var(--secondary);
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .nav-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid var(--secondary);
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .back-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            margin-right: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #1a252f;
        }

        .back-button i {
            margin-right: 5px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* Content Area */
        .content {
            padding: 30px;
            flex: 1;
            overflow-y: auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            padding: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .card-header h2 {
            font-size: 18px;
            color: var(--primary);
        }

        .card-header i {
            color: var(--secondary);
            font-size: 20px;
        }

        /* Map */
        #map-container {
            grid-column: 1 / -1;
            height: 400px;
            margin-bottom: 20px;
            position: relative;
        }

        #map {
            height: 100%;
            border-radius: 10px;
        }

        /* Map Search */
        .map-search-container {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            padding: 5px;
            width: 350px;
        }

        .map-search-container input {
            flex: 1;
            border: none;
            padding: 10px;
            outline: none;
            font-size: 14px;
        }

        .map-search-container button {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.3s;
            margin-left: 5px;
        }

        .map-search-container button:hover {
            background: #2980b9;
        }

        .voice-search-btn {
            background: var(--accent) !important;
        }

        .voice-search-btn.listening {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { background-color: var(--accent); }
            50% { background-color: #ff6b6b; }
            100% { background-color: var(--accent); }
        }

        /* Search Results */
        .search-results {
            position: absolute;
            top: 50px;
            right: 15px;
            z-index: 1000;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            max-height: 200px;
            overflow-y: auto;
            width: 350px;
            display: none;
        }

        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f5f7fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        .stat-card i {
            font-size: 24px;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .stat-card h3 {
            font-size: 28px;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-card p {
            color: var(--gray);
            font-size: 14px;
        }

        /* Stop List */
        .stop-list {
            list-style: none;
        }

        .stop-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .stop-item:last-child {
            border-bottom: none;
        }

        .stop-info {
            display: flex;
            align-items: center;
        }

        .stop-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-size: 12px;
        }

        .stop-time {
            color: var(--gray);
            font-size: 14px;
        }

        /* Buttons */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Notifications */
        .notification-list {
            list-style: none;
        }

        .notification-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: flex-start;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-icon {
            margin-right: 10px;
            color: var(--warning);
            font-size: 18px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-time {
            font-size: 12px;
            color: var(--gray);
        }

        /* Demand and Delay Indicators */
        .demand-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .demand-fill {
            height: 100%;
            border-radius: 4px;
        }

        .demand-low {
            background: var(--success);
            width: 30%;
        }

        .demand-medium {
            background: var(--warning);
            width: 60%;
        }

        .demand-high {
            background: var(--accent);
            width: 90%;
        }

        .delay-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .delay-low {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }

        .delay-medium {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }

        .delay-high {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent);
        }

        /* Unified Dashboard */
        .unified-dashboard {
            grid-column: 1 / -1;
            margin-bottom: 20px;
        }

        .dashboard-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .route-delay-item,
        .stop-demand-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .route-info,
        .stop-info {
            display: flex;
            align-items: center;
        }

        .route-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 10px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }

            .logo h1,
            .nav-item span {
                display: none;
            }

            .logo {
                justify-content: center;
            }

            .nav-item {
                justify-content: center;
            }

            .nav-item i {
                margin-right: 0;
                font-size: 20px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
            }

            .dashboard-tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                text-align: center;
                min-width: 120px;
            }

            .map-search-container {
                width: 280px;
            }

            .search-results {
                width: 280px;
            }
        }

        @media (max-width: 576px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-left {
                margin-bottom: 10px;
            }

            .header-actions {
                margin-top: 15px;
                align-self: stretch;
            }

            .tab {
                min-width: 100px;
                padding: 10px;
            }

            .map-search-container {
                width: 230px;
            }

            .search-results {
                width: 230px;
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-bus"></i>
            <h1>Punjab Village Transit</h1>
        </div>

        <div class="nav-item active">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-route"></i>
            <span>Village Routes</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>Live Location</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-clock"></i>
            <span>Schedule</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-chart-bar"></i>
            <span>Trips & Earnings</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>

        <div style="margin-top: auto; padding: 20px;">
            <button class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <button class="back-button" id="homeButton">
                    <i class="fas fa-home"></i>
                    Home
                </button>
                <h2>Punjab Village Driver Portal</h2>
            </div>
            <div class="user-info">
                <img src="https://ui-avatars.com/api/?name=Gurpreet+Singh&background=3498db&color=fff" alt="Driver">
                <div>
                    <div>Gurpreet Singh</div>
                    <small>Route: Amritsar Rural Circuit</small>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <i class="fas fa-route"></i>
                    <h3>6</h3>
                    <p>Village Routes</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h3>89</h3>
                    <p>Passengers Today</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3>₹1,240</h3>
                    <p>Today's Earnings</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <h3>87%</h3>
                    <p>On-Time Performance</p>
                </div>
            </div>

            <!-- Map and Route Info -->
            <div class="dashboard-grid">
                <div id="map-container">
                    <div class="card-header">
                        <h2><i class="fas fa-map-marked-alt"></i> Punjab Village Routes Map</h2>
                        <div>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                            <span style="margin-left: 10px; font-size: 14px;">Live Sharing</span>
                        </div>
                    </div>

                    <!-- Map Search -->
                    <div class="map-search-container">
                        <input type="text" id="map-search" placeholder="Search for villages...">
                        <button id="search-button">
                            <i class="fas fa-search"></i>
                        </button>
                        <button id="voice-search-button" class="voice-search-btn">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>

                    <!-- Search Results -->
                    <div class="search-results" id="search-results"></div>

                    <div id="map"></div>
                </div>

                <!-- Punjab Small Cities Dashboard -->
                <div class="card unified-dashboard">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Punjab Village Routes Dashboard</h2>
                        <i class="fas fa-ellipsis-h"></i>
                    </div>

                    <div class="dashboard-tabs">
                        <div class="tab active" data-tab="delays">Route Delays</div>
                        <div class="tab" data-tab="demand">Stop Demand</div>
                    </div>

                    <div class="tab-content active" id="delays">
                        <div class="route-delay-item">
                            <div class="route-info">
                                <div class="route-color" style="background: #e74c3c;"></div>
                                <div>
                                    <div>Amritsar Rural Circuit</div>
                                    <small>Via: Chheharta, Rayya, Jandiala Guru</small>
                                </div>
                            </div>
                            <div class="delay-tag delay-high">22 min delay</div>
                        </div>

                        <div class="route-delay-item">
                            <div class="route-info">
                                <div class="route-color" style="background: #f39c12;"></div>
                                <div>
                                    <div>Tarn Taran Village Route</div>
                                    <small>Via: Bhikhiwind, Patti, Khem Karan</small>
                                </div>
                            </div>
                            <div class="delay-tag delay-medium">15 min delay</div>
                        </div>

                        <div class="route-delay-item">
                            <div class="route-info">
                                <div class="route-color" style="background: #3498db;"></div>
                                <div>
                                    <div>Gurdaspur Village Loop</div>
                                    <small>Via: Dhariwal, Kalanaur, Dera Baba Nanak</small>
                                </div>
                            </div>
                            <div class="delay-tag delay-low">8 min delay</div>
                        </div>

                        <div class="route-delay-item">
                            <div class="route-info">
                                <div class="route-color" style="background: #2ecc71;"></div>
                                <div>
                                    <div>Kapurthala Village Route</div>
                                    <small>Via: Sultanpur Lodhi, Phagwara, Begowal</small>
                                </div>
                            </div>
                            <div class="delay-tag delay-low">5 min delay</div>
                        </div>
                    </div>

                    <div class="tab-content" id="demand">
                        <div class="stop-demand-item">
                            <div class="stop-info">
                                <div class="stop-marker">1</div>
                                <div>
                                    <div>Chheharta, Amritsar</div>
                                    <small>Route: Amritsar Rural Circuit</small>
                                </div>
                            </div>
                            <div>
                                <div class="demand-bar">
                                    <div class="demand-fill demand-high"></div>
                                </div>
                                <small>High demand</small>
                            </div>
                        </div>

                        <div class="stop-demand-item">
                            <div class="stop-info">
                                <div class="stop-marker">2</div>
                                <div>
                                    <div>Bhikhiwind, Tarn Taran</div>
                                    <small>Route: Tarn Taran Village Route</small>
                                </div>
                            </div>
                            <div>
                                <div class="demand-bar">
                                    <div class="demand-fill demand-high"></div>
                                </div>
                                <small>High demand</small>
                            </div>
                        </div>

                        <div class="stop-demand-item">
                            <div class="stop-info">
                                <div class="stop-marker">3</div>
                                <div>
                                    <div>Dhariwal, Gurdaspur</div>
                                    <small>Route: Gurdaspur Village Loop</small>
                                </div>
                            </div>
                            <div>
                                <div class="demand-bar">
                                    <div class="demand-fill demand-medium"></div>
                                </div>
                                <small>Medium demand</small>
                            </div>
                        </div>

                        <div class="stop-demand-item">
                            <div class="stop-info">
                                <div class="stop-marker">4</div>
                                <div>
                                    <div>Sultanpur Lodhi, Kapurthala</div>
                                    <small>Route: Kapurthala Village Route</small>
                                </div>
                            </div>
                            <div>
                                <div class="demand-bar">
                                    <div class="demand-fill demand-medium"></div>
                                </div>
                                <small>Medium demand</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Stops -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-list-ol"></i> Upcoming Stops</h2>
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    <ul class="stop-list">
                        <li class="stop-item">
                            <div class="stop-info">
                                <div class="stop-marker">1</div>
                                <div>
                                    <div>Chheharta, Amritsar</div>
                                    <small class="stop-time">Next stop • ETA: 10 min</small>
                                </div>
                            </div>
                            <div>2.1 km</div>
                        </li>
                        <li class="stop-item">
                            <div class="stop-info">
                                <div class="stop-marker">2</div>
                                <div>
                                    <div>Rayya Village</div>
                                    <small class="stop-time">ETA: 18 min</small>
                                </div>
                            </div>
                            <div>5.3 km</div>
                        </li>
                        <li class="stop-item">
                            <div class="stop-info">
                                <div class="stop-marker">3</div>
                                <div>
                                    <div>Jandiala Guru</div>
                                    <small class="stop-time">ETA: 25 min</small>
                                </div>
                            </div>
                            <div>8.7 km</div>
                        </li>
                        <li class="stop-item">
                            <div class="stop-info">
                                <div class="stop-marker">4</div>
                                <div>
                                    <div>Raja Sansi</div>
                                    <small class="stop-time">ETA: 35 min</small>
                                </div>
                            </div>
                            <div>12.4 km</div>
                        </li>
                    </ul>
                </div>

                <!-- Notifications -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-bell"></i> Notifications</h2>
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    <ul class="notification-list">
                        <li class="notification-item">
                            <div class="notification-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="notification-content">
                                <div>Road work on Rayya-Jandiala route. Expect delays.</div>
                                <div class="notification-time">25 minutes ago</div>
                            </div>
                        </li>
                        <li class="notification-item">
                            <div class="notification-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="notification-content">
                                <div>Increased service to Chheharta during peak hours.</div>
                                <div class="notification-time">2 hours ago</div>
                            </div>
                        </li>
                        <li class="notification-item">
                            <div class="notification-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="notification-content">
                                <div>Your vehicle maintenance is up to date.</div>
                                <div class="notification-time">5 hours ago</div>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Trip Summary -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-pie"></i> Today's Trip Summary</h2>
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Completed Trips:</span>
                            <span>3/5</span>
                        </div>
                        <div style="height: 10px; background: #eee; border-radius: 5px; overflow: hidden;">
                            <div style="height: 100%; width: 60%; background: var(--success);"></div>
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Passengers:</span>
                            <span>89</span>
                        </div>
                        <div style="height: 10px; background: #eee; border-radius: 5px; overflow: hidden;">
                            <div style="height: 100%; width: 70%; background: var(--secondary);"></div>
                        </div>
                    </div>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Earnings:</span>
                            <span>₹1,240/₹2,000</span>
                        </div>
                        <div style="height: 10px; background: #eee; border-radius: 5px; overflow: hidden;">
                            <div style="height: 100%; width: 62%; background: var(--warning);"></div>
                        </div>
                    </div>
                </div>

                <!-- Send Announcement -->
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-bullhorn"></i> Send Announcement</h2>
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    <div class="form-group">
                        <label for="announcement">Message to Passengers</label>
                        <textarea class="form-control" id="announcement" rows="3"
                            placeholder="Enter message for passengers..."></textarea>
                    </div>
                    <button class="btn btn-warning" style="width: 100%;">
                        <i class="fas fa-paper-plane"></i> Send to Passengers
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map centered on Punjab
        const map = L.map('map').setView([31.1471, 75.3412], 9);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Add markers for Punjab villages
        const punjabVillages = [
            { name: "Chheharta (Amritsar)", latlng: [31.6300, 74.8500] },
            { name: "Rayya (Amritsar)", latlng: [31.5200, 74.9500] },
            { name: "Jandiala Guru (Amritsar)", latlng: [31.5600, 75.0300] },
            { name: "Bhikhiwind (Tarn Taran)", latlng: [31.3500, 74.8000] },
            { name: "Patti (Tarn Taran)", latlng: [31.2800, 74.8500] },
            { name: "Khem Karan (Tarn Taran)", latlng: [31.1500, 74.5500] },
            { name: "Dhariwal (Gurdaspur)", latlng: [31.9500, 75.3200] },
            { name: "Kalanaur (Gurdaspur)", latlng: [32.0200, 75.1500] },
            { name: "Dera Baba Nanak (Gurdaspur)", latlng: [32.0300, 75.0300] },
            { name: "Sultanpur Lodhi (Kapurthala)", latlng: [31.2100, 75.2000] },
            { name: "Begowal (Kapurthala)", latlng: [31.6100, 75.5200] },
            { name: "Raja Sansi (Amritsar)", latlng: [31.7200, 74.8000] }
        ];

        // Store markers for search functionality
        const villageMarkers = [];

        punjabVillages.forEach(village => {
            const marker = L.marker(village.latlng)
                .addTo(map)
                .bindPopup('<b>' + village.name + '</b>');

            // Store marker with village data for search
            villageMarkers.push({
                marker: marker,
                name: village.name,
                latlng: village.latlng
            });
        });

        // Add a bus marker for Amritsar rural route
        const busMarker = L.marker([31.6300, 74.8500]).addTo(map)
            .bindPopup('Bus #PB02 CD 4567<br>Driver: Gurpreet Singh')
            .openPopup();

        // Add route line for Amritsar rural circuit
        const amritsarRuralRoute = [
            [31.6300, 74.8500],
            [31.6000, 74.8700],
            [31.5700, 74.9000],
            [31.5200, 74.9500],
            [31.5600, 75.0300],
            [31.6000, 75.0800]
        ];

        const routeLine = L.polyline(amritsarRuralRoute, { color: 'blue' }).addTo(map);

        // Add stops for Amritsar rural circuit
        const amritsarStops = [
            { pos: [31.6300, 74.8500], name: "Chheharta" },
            { pos: [31.6000, 74.8700], name: "Goniana" },
            { pos: [31.5700, 74.9000], name: "Verka" },
            { pos: [31.5200, 74.9500], name: "Rayya" },
            { pos: [31.5600, 75.0300], name: "Jandiala Guru" },
            { pos: [31.6000, 75.0800], name: "Raja Sansi" }
        ];

        amritsarStops.forEach((stop, index) => {
            L.marker(stop.pos)
                .addTo(map)
                .bindPopup('<b>Stop ' + (index + 1) + '</b><br>' + stop.name);
        });

        // Search functionality
        const searchInput = document.getElementById('map-search');
        const searchButton = document.getElementById('search-button');
        const voiceSearchButton = document.getElementById('voice-search-button');
        const searchResults = document.getElementById('search-results');

        searchInput.addEventListener('input', function () {
            const query = this.value.toLowerCase();

            if (query.length < 2) {
                searchResults.style.display = 'none';
                return;
            }

            // Filter villages based on search query
            const filteredVillages = villageMarkers.filter(village =>
                village.name.toLowerCase().includes(query)
            );

            // Display results
            if (filteredVillages.length > 0) {
                searchResults.innerHTML = '';
                filteredVillages.forEach(village => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.textContent = village.name;
                    resultItem.addEventListener('click', function () {
                        // Zoom to the village
                        map.setView(village.latlng, 13);
                        // Open the marker's popup
                        village.marker.openPopup();
                        // Clear search and hide results
                        searchInput.value = '';
                        searchResults.style.display = 'none';
                    });
                    searchResults.appendChild(resultItem);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.style.display = 'none';
            }
        });

        searchButton.addEventListener('click', function () {
            const query = searchInput.value.toLowerCase();

            if (query.length < 2) return;

            // Find the first matching village
            const foundVillage = villageMarkers.find(village =>
                village.name.toLowerCase().includes(query)
            );

            if (foundVillage) {
                // Zoom to the village
                map.setView(foundVillage.latlng, 13);
                // Open the marker's popup
                foundVillage.marker.openPopup();
                // Clear search and hide results
                searchInput.value = '';
                searchResults.style.display = 'none';
            }
        });

        // Voice search functionality
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            voiceSearchButton.addEventListener('click', () => {
                if (voiceSearchButton.classList.contains('listening')) {
                    recognition.stop();
                    voiceSearchButton.classList.remove('listening');
                    return;
                }

                try {
                    recognition.start();
                    voiceSearchButton.classList.add('listening');
                    searchInput.placeholder = "Listening...";
                } catch (err) {
                    console.error('Speech recognition error:', err);
                    voiceSearchButton.classList.remove('listening');
                    searchInput.placeholder = "Search for villages...";
                }
            });

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchInput.value = transcript;
                searchInput.dispatchEvent(new Event('input'));
                
                // Trigger search after a short delay
                setTimeout(() => {
                    searchButton.click();
                }, 500);
            };

            recognition.onend = () => {
                voiceSearchButton.classList.remove('listening');
                searchInput.placeholder = "Search for villages...";
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                voiceSearchButton.classList.remove('listening');
                searchInput.placeholder = "Search for villages...";
                
                if (event.error === 'not-allowed') {
                    alert('Microphone access is blocked. Please allow microphone access to use voice search.');
                }
            };
        } else {
            // Browser doesn't support speech recognition
            voiceSearchButton.style.display = 'none';
        }

        // Close search results when clicking outside
        document.addEventListener('click', function (e) {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target) && !searchButton.contains(e.target) && !voiceSearchButton.contains(e.target)) {
                searchResults.style.display = 'none';
            }
        });

        // Home button functionality
        document.getElementById('homeButton').addEventListener('click', function () {
            // In a real application, this would navigate to the home page
            // For demonstration, we'll reload the page
            window.location.href = "\index.html"; // Replace with your actual home page URL
            // For this demo, we'll just show an alert
            alert("Navigating to Home Page");
        });

        // Tab functionality for unified dashboard
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Simulate bus movement (in a real app, this would come from GPS)
        let currentPoint = 0;
        function moveBus() {
            if (currentPoint < amritsarRuralRoute.length - 1) {
                currentPoint++;
                const newLatLng = L.latLng(amritsarRuralRoute[currentPoint][0], amritsarRuralRoute[currentPoint][1]);
                busMarker.setLatLng(newLatLng);
                setTimeout(moveBus, 5000);
            }
        }

        // Start bus movement after a delay
        setTimeout(moveBus, 3000);
    </script>
</body>

</html>